<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Añadir Estudiante</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container my-5">
    <h1 class="text-center mb-4">Añadir nuevo estudiante</h1>
    <form id="form-estudiante" class="bg-white p-4 shadow rounded">
        <!-- Carrera -->
        <div class="mb-3">
            <label for="carrera" class="form-label">Carrera:</label>
            <select id="carrera" name="carrera" class="form-select" required>
                <option value="">Seleccione una opción</option>
                <option value="Ingeniería de Sistemas">Ingeniería de Sistemas</option>
                <option value="Ingeniería Electrónica">Ingeniería Electrónica</option>
            </select>
        </div>

        <!-- Gustos por género -->
        <fieldset class="mb-4">
            <legend class="h5">Preferencia por géneros (0 a 10)</legend>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="genero_accion" class="form-label">Acción</label>
                    <input type="number" class="form-control" id="genero_accion" min="0" max="10" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="genero_ciencia_ficcion" class="form-label">Ciencia ficción</label>
                    <input type="number" class="form-control" id="genero_ciencia_ficcion" min="0" max="10" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="genero_comedia" class="form-label">Comedia</label>
                    <input type="number" class="form-control" id="genero_comedia" min="0" max="10" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="genero_terror" class="form-label">Terror</label>
                    <input type="number" class="form-control" id="genero_terror" min="0" max="10" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="genero_documental" class="form-label">Documental</label>
                    <input type="number" class="form-control" id="genero_documental" min="0" max="10" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="genero_romance" class="form-label">Romance</label>
                    <input type="number" class="form-control" id="genero_romance" min="0" max="10" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="genero_musicales" class="form-label">Musicales</label>
                    <input type="number" class="form-control" id="genero_musicales" min="0" max="10" required>
                </div>
            </div>
        </fieldset>

        <!-- Notas -->
        <fieldset class="mb-4">
            <legend class="h5">Notas (0 a 5)</legend>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="poo" class="form-label">POO</label>
                    <input type="number" class="form-control" id="poo" step="0.1" min="0" max="5" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="calculo_multivariado" class="form-label">Cálculo Multivariado</label>
                    <input type="number" class="form-control" id="calculo_multivariado" step="0.1" min="0" max="5" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="ctd" class="form-label">CTD</label>
                    <input type="number" class="form-control" id="ctd" step="0.1" min="0" max="5" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="ingenieria_software" class="form-label">Ingeniería de Software</label>
                    <input type="number" class="form-control" id="ingenieria_software" step="0.1" min="0" max="5" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="bases_datos" class="form-label">Bases de Datos</label>
                    <input type="number" class="form-control" id="bases_datos" step="0.1" min="0" max="5" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="control_analogo" class="form-label">Control Análogo</label>
                    <input type="number" class="form-control" id="control_analogo" step="0.1" min="0" max="5" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="circuitos_digitales" class="form-label">Circuitos Digitales</label>
                    <input type="number" class="form-control" id="circuitos_digitales" step="0.1" min="0" max="5" required>
                </div>
            </div>
        </fieldset>

        <div class="text-center">
            <button type="submit" class="btn btn-primary px-5">Guardar</button>
        </div>
    </form>
</div>

<script>
    document.getElementById("form-estudiante").addEventListener("submit", async (e) => {
        e.preventDefault();

        const getValue = id => document.getElementById(id).value;

        const estudiante = {
            carrera: getValue("carrera"),
            genero_accion: parseInt(getValue("genero_accion")),
            genero_ciencia_ficcion: parseInt(getValue("genero_ciencia_ficcion")),
            genero_comedia: parseInt(getValue("genero_comedia")),
            genero_terror: parseInt(getValue("genero_terror")),
            genero_documental: parseInt(getValue("genero_documental")),
            genero_romance: parseInt(getValue("genero_romance")),
            genero_musicales: parseInt(getValue("genero_musicales")),
            poo: parseFloat(getValue("poo")),
            calculo_multivariado: parseFloat(getValue("calculo_multivariado")),
            ctd: parseFloat(getValue("ctd")),
            ingenieria_software: parseFloat(getValue("ingenieria_software")),
            bases_datos: parseFloat(getValue("bases_datos")),
            control_analogo: parseFloat(getValue("control_analogo")),
            circuitos_digitales: parseFloat(getValue("circuitos_digitales"))
        };

        const validNota = n => n >= 0 && n <= 5;
        const validGenero = g => g >= 0 && g <= 10;

        const notas = [
            estudiante.poo, estudiante.calculo_multivariado, estudiante.ctd,
            estudiante.ingenieria_software, estudiante.bases_datos,
            estudiante.control_analogo, estudiante.circuitos_digitales
        ];
        const generos = [
            estudiante.genero_accion, estudiante.genero_ciencia_ficcion,
            estudiante.genero_comedia, estudiante.genero_terror,
            estudiante.genero_documental, estudiante.genero_romance,
            estudiante.genero_musicales
        ];

        if (!notas.every(validNota) || !generos.every(validGenero)) {
            alert("Verifica que las notas estén entre 0-5 y los géneros entre 0-10.");
            return;
        }

        const res = await fetch("/api/estudiantes", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(estudiante)
        });

        if (res.ok) {
            alert("Estudiante añadido correctamente");
            window.location.href = "/";
        } else {
            const msg = await res.text();
            alert("Error al guardar: " + msg);
        }
    });
</script>
<script src="/static/main.js"></script>
</body>
</html>
